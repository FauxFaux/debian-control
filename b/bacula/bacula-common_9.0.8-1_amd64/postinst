#!/bin/sh

set -e

. /usr/share/debconf/confmodule
db_version 2.0


case "$1" in
    configure)
	chown bacula:bacula /var/lib/bacula
	chmod 700 /var/lib/bacula
	chown bacula:adm /var/log/bacula
	chmod 750 /var/log/bacula

        . /usr/share/bacula-common/common-functions.dpkg
        readOrCreatePasswords # create our common passwords if needed

	# remove temporary files erroneously created in /
	if dpkg --compare-versions "$2" ge "9.0.5" && dpkg --compare-versions "$2" lt "9.0.7+dfsg-2~"; then
	    rm -f /bacula-console.conf.ucftmp-*
	    rm -f /bacula-director.conf.ucftmp-*
	    rm -f /bacula-fd.conf.ucftmp-*
	    rm -f /bacula-qt-console.conf.ucftmp-*
	    rm -f /bacula-sd.conf.ucftmp-*
	fi
    ;;
esac


# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

# Automatically added by dh_installsystemd/11.3.2
if [ "$1" = "configure" ] || [ "$1" = "abort-upgrade" ] || [ "$1" = "abort-deconfigure" ] || [ "$1" = "abort-remove" ] ; then
	# In case this system is running systemd, we need to ensure that all
	# necessary tmpfiles (if any) are created before starting.
	if [ -d /run/systemd/system ] ; then
		systemd-tmpfiles --create bacula.conf >/dev/null || true
	fi
fi
# End automatically added section
# Automatically added by dh_installdeb/11.3.2
dpkg-maintscript-helper rm_conffile /etc/tmpfiles.d/bacula.conf 7.4.3\+dfsg-2\~ -- "$@"
# End automatically added section


exit 0
