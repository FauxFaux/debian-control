#!/bin/sh

set -e

case "$1" in
	install)
		if ! getent passwd bacula >/dev/null; then
			echo -n "Adding user 'bacula'... "
			adduser --system --group --home /var/lib/bacula bacula >/dev/null 2>&1
			usermod -c "Bacula" bacula
			usermod -G tape bacula
			echo "Ok."
		fi
	;;
	install|upgrade)
		# purging bacula-director-common can mistakenly delete bacula-dir.conf
		# neutralize the offending line in its postrm; see bug #880529 for details
		if dpkg-query -l bacula-director-common > /dev/null 2>&1 && \
		   [ -e /var/lib/dpkg/info/bacula-director-common.postrm ]; then
			sed -i 's/rm -f $CONFFILE $CONFFILE.dist/#disabled: bug #880529# rm -f $CONFFILE $CONFFILE.dist/' /var/lib/dpkg/info/bacula-director-common.postrm
		fi
	;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

# Automatically added by dh_installdeb/12
dpkg-maintscript-helper rm_conffile /etc/tmpfiles.d/bacula.conf 7.4.3\+dfsg-2\~ -- "$@"
# End automatically added section


exit 0
