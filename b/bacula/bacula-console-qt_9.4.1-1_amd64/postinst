#!/bin/sh

set -e

PKG_NAME="bacula-console-qt"
CONFIG="bat.conf"
TEMPLATE="/usr/share/bacula-common/defconfig/$CONFIG"
TARGET="/etc/bacula/$CONFIG"

case "$1" in
    configure)
	. /usr/share/bacula-common/common-functions.dpkg
	readOrCreatePasswords

	# create new bat.conf using the template
	TMP_CONFIG="$(mktemp -p /tmp $PKG_NAME.conf.ucftmp-XXXXXXXXXX)"
	chmod 640 $TMP_CONFIG
	chown root:bacula $TMP_CONFIG

	sed -e s~@debian_basename@~`hostname`~ \
	    -e s~XXX_DIRPASSWORD_XXX~$DIRPASSWD~ \
	    $TEMPLATE > $TMP_CONFIG
	# let ucf handle the conffile and register it
	ucf --debconf-ok --three-way $TMP_CONFIG $TARGET
	ucfr $PKG_NAME $TARGET
	rm -f $TMP_CONFIG
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

# Automatically added by dh_installdeb/12
dpkg-maintscript-helper dir_to_symlink /usr/share/doc/bacula-console-qt bacula-common 7.0.5\+dfsg-4\~ -- "$@"
# End automatically added section


exit 0
