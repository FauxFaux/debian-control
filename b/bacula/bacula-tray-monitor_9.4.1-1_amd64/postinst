#!/bin/sh

set -e

PKG_NAME="bacula-tray-monitor"
CONFIG="bacula-tray-monitor.conf"
TEMPLATE="/usr/share/bacula-common/defconfig/$CONFIG"
TARGET="/etc/bacula/$CONFIG"

case "$1" in
    configure)
	. /usr/share/bacula-common/common-functions.dpkg
	readOrCreatePasswords

	# create new bacula-tray-monitor.conf using the template
	TMP_CONFIG="$(mktemp -p /tmp $PKG_NAME.conf.ucftmp-XXXXXXXXXX)"
	chmod 640 $TMP_CONFIG
	chown root:bacula $TMP_CONFIG

	sed -e s~@debian_basename@~`hostname`~ \
	    -e s~XXX_MONDIRPASSWORD_XXX~$DIRMPASSWD~ \
	    -e s~XXX_MONFDPASSWORD_XXX~$FDMPASSWD~ \
	    -e s~XXX_MONSDPASSWORD_XXX~$SDMPASSWD~ \
	    $TEMPLATE > $TMP_CONFIG
	# let ucf handle the conffile and register it
	ucf --debconf-ok --three-way $TMP_CONFIG $TARGET
	ucfr $PKG_NAME $TARGET
	rm -f $TMP_CONFIG
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.



exit 0
