#!/bin/sh
set -e

setup_pkcs11proxyd_user() {
        if ! getent passwd Debian-pkcs11proxyd >/dev/null; then
                adduser --system --group --quiet --home /var/lib/pkcs11proxyd \
                        --force-badname Debian-pkcs11proxyd
        fi
}

fix_permissions() {
        chown -R root:Debian-pkcs11proxyd /etc/pkcs11proxyd
        chmod 640 /etc/pkcs11proxyd/filter.conf
        chmod 640 /etc/pkcs11proxyd/pkcs11proxyd.conf
}

if [ "$1" = configure ]; then
	setup_pkcs11proxyd_user
	fix_permissions
fi

# Automatically added by dh_installinit
if [ "$1" = "configure" ] || [ "$1" = "abort-upgrade" ]; then
	if [ -x "/etc/init.d/caml-crush-server" ]; then
		update-rc.d caml-crush-server defaults >/dev/null
		invoke-rc.d caml-crush-server start || exit $?
	fi
fi
# End automatically added section


exit 0
