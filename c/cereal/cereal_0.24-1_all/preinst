#!/bin/sh -e

# preinst script for cereal

# Author: Jameson Graef Rollins <jrollins@finestructure.net> and 
#         Daniel Kahn Gillmor <dkg@fifthhorseman.net>
# (c) 2007

# make new sessions dir and move all old sessions into it
if [ -d /var/lib/cereal/ -a ! -d /var/lib/cereal/sessions ] ; then
    echo "moving sessions to new session directory /var/lib/cereal/sessions/..."

    # find all active sessions
    SESSIONS=$(cereal list | cut -d ' ' -f 2)

    mkdir -p /var/lib/cereal/sessions

    for SESSION in $SESSIONS ; do
	echo "moving '$SESSION'..."
	mv /var/lib/cereal/"$SESSION" /var/lib/cereal/sessions/"$SESSION"
	if [ -L "/var/service/cereal.$SESSION" ] ; then
	    ln -sfn "/var/lib/cereal/sessions/$SESSION" "/var/service/cereal.$SESSION"
	fi
    done
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.



exit 0
