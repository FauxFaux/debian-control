#!/bin/sh
set -e

case "$1" in
    purge)
	rm -rf /var/run/cipux-rpcdr

	if id cipux-rpcdr >/dev/null 2>&1; then
		if [ -x /usr/sbin/deluser ]; then
			deluser cipux-rpcdr
		fi
	fi

	# Remove group only if empty
	if getent group ssl-cert | awk -F: ' { print $4 } ' | egrep -cq '^$'; then
# TODO: Have ssl-cert package join the group too, and cleanup if we are purged last
#		if which groupdel > /dev/null; then
#			groupdel ssl-cert || echo "Error occured removing group ssl-cert, please do it manually."
#		fi
		echo "Unable to determine if ssl-cert group should be removed, please do it manually if needed."
	fi
	;;
    remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)

	;;
    *)
	echo "postrm called with unknown argument \`$1'" >&2
	exit 1
esac

# Automatically added by dh_installinit
if [ "$1" = "purge" ] ; then
	update-rc.d cipux-rpcd remove >/dev/null
fi


# In case this system is running systemd, we make systemd reload the unit files
# to pick up changes.
if [ -d /run/systemd/system ] ; then
	systemctl --system daemon-reload >/dev/null || true
fi
# End automatically added section


# Refresh stunnel to stop wrapper when cipux-rpcdr.conf has been purged
if [ "$1" = "purge" ] && [ -x "/etc/init.d/stunnel4" ]; then
	if [ -x "`which invoke-rc.d 2>/dev/null`" ]; then
		invoke-rc.d stunnel4 force-reload || exit $?
	else
		/etc/init.d/stunnel4 force-reload || exit $?
	fi
fi
