#! /bin/sh
# postrm script for GOsa
#

set -e

PATH="/usr/bin:/usr/sbin:/bin:/sbin"
export PATH

case "$1" in
	purge)
		if [ -d /var/spool/gosa ] ; then
			echo "Removing /var/spool/gosa as requested."
			rm -Rf /var/spool/gosa
		fi
		if [ -d /var/cache/gosa ] ; then
			echo "Removing /var/cache/gosa as requested."
			rm -Rf /var/cache/gosa
		fi

		if [ -e /etc/gosa/gosa.secrets ]; then rm /etc/gosa/gosa.secrets; fi
		if [ -e /usr/share/gosa/html/themes/default/images/img.png ]; then rm /usr/share/gosa/html/themes/default/images/img.png; fi
		if [ -e /usr/share/gosa/ihtml/themes/default/img.styles ]; then rm /usr/share/gosa/ihtml/themes/default/img.styles; fi
		if [ -d /usr/share/gosa ]; then find /usr/share/gosa -depth -type d -empty -exec rmdir "{}" \;; fi
		rmdir --ignore-fail-on-non-empty /etc/gosa/
	;;

	remove|purge)
		if [ -d /etc/apache2/conf.d ]; then
			# Remove GOsa include
			if [ -L /etc/apache2/conf.d/gosa.conf ]; then
				rm -f /etc/apache2/conf.d/gosa.conf
			fi

			# Restart servers
			if [ -x "$(which apache2ctl)" ]; then
				if [ -x "$(which invoke-rc.d)" ]; then
					invoke-rc.d apache2 restart
				else
					/etc/init.d/apache2 restart
				fi
			fi
		fi

		if [ -d /etc/apache2/conf-available ] ; then
			if [ -e /usr/share/apache2/apache2-maintscript-helper ] ; then
				. /usr/share/apache2/apache2-maintscript-helper
				apache2_invoke disconf gosa
			elif [ -L /etc/apache2/conf-enabled/gosa.conf ]; then
				rm -f /etc/apache2/conf-enabled/gosa.conf
			fi

			if [ -L /etc/apache2/conf-available/gosa.conf ]; then
				rm -f /etc/apache2/conf-available/gosa.conf
			fi

			# Finally restart servers
			if [ -x "$(which apache2ctl)" ]; then
				if [ -x "$(which invoke-rc.d)" ]; then
					invoke-rc.d apache2 reload
				else
					/etc/init.d/apache2 reload
				fi
			fi
		fi

		if [ -d /etc/lighttpd/conf-available ]; then
			# Remove GOsa include
			if [ -L /etc/lighttpd/conf-enabled/99gosa-lighttpd.conf ]; then
				rm -f /etc/lighttpd/conf-enabled/99gosa-lighttpd.conf
			fi

			# Restart servers
			if [ -x "$(which lighttpd)" ]; then
				if [ -x "$(which invoke-rc.d)" ]; then
					invoke-rc.d lighttpd restart
				else
					/etc/init.d/lighttpd restart
				fi
			fi
		fi
	;;

	upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
	;;

	*)
		echo "postrm called with unknown argument \`$1'" >&2
		exit 0
	;;
esac



exit 0
