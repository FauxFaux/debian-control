#! /bin/sh
# postinst script for greylistd
#
# see: dh_installdeb(1)

# This script is called twice during the removal of the package; once
# after the removal of the package's files from the system, and as
# the final step in the removal of this package, after the package's
# conffiles have been removed.

set -e

case "$1" in
    remove|upgrade|abort-upgrade|failed-upgrade)
	;;

    purge)
	for file in /etc/greylistd/whitelist-hosts \
                    /var/lib/greylistd/states \
                    /var/lib/greylistd/triplets
        do
	    if [ -f "$file" ]
	    then
		echo -n "Removing $file:"
		rm -rf "$file"
		echo " Done."
	     fi
	done

        ### The following keeps "make" silent during adduser/deluser
        ### operations on YP/NIS systems.
	export MAKEFLAGS
	MAKEFLAGS=-s

	if id -u greylist >/dev/null 2>&1
	then
                if [ -x "$(command -v deluser)" ]; then
  	            deluser --system greylist
                    delgroup --system greylist >/dev/null 2>&1 || true
                else
                    echo >&2 "not removing greylist system account because deluser command was not found"
                fi
	fi
	;;

    *)
	echo "postrm called with unknown argument \`$1'" >&2
	exit 1
	;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.
# Automatically added by dh_installdeb
dpkg-maintscript-helper rm_conffile /etc/init.d/greylist 0.8.8.5~ -- "$@"
# End automatically added section
# Automatically added by dh_installinit
if [ "$1" = "purge" ] ; then
	update-rc.d greylistd remove >/dev/null
fi


# In case this system is running systemd, we make systemd reload the unit files
# to pick up changes.
if [ -d /run/systemd/system ] ; then
	systemctl --system daemon-reload >/dev/null || true
fi
# End automatically added section
# Automatically added by dh_installdebconf
if [ "$1" = purge ] && [ -e /usr/share/debconf/confmodule ]; then
	. /usr/share/debconf/confmodule
	db_purge
fi
# End automatically added section


exit 0
