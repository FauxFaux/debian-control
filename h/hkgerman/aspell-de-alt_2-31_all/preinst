#! /bin/sh
# preinst script for aspell-de

set -e

# summary of how this script can be called:
#        * <new-preinst> `install'
#        * <new-preinst> `install' <old-version>
#        * <new-preinst> `upgrade' <old-version>
#        * <old-preinst> `abort-upgrade' <new-version>

case "$1" in
    install|upgrade)
	# Remove old (pre 2-31) stuff:
	if dpkg --compare-versions "$2" lt-nl 1:2-31
	then
	    DIR="/usr/lib/aspell"
            update-alternatives --remove de.multi $DIR/de-alt.multi

	    dico_class="aspell"
	    dico_varlib_remove="de-alt.compat de-alt.remove de-alt-CH.rws de-alt-DE.rws de-alt-common.rws"
	    dico_varlib_rmfiles="de-alt.remove"

	    if [ -d "/var/lib/$dico_class" ]; then
		( cd "/var/lib/$dico_class" &&
			for rmfile in $dico_varlib_rmfiles; do
			    for i in $(grep -s -e ^/usr/lib/$class -e ^/var/lib/$class "$rmfile"); do
				if [ -e "$i" ]; then
				    if [ -d "$i" ]; then
					rmdir --ignore-fail-on-non-empty "$i"
				    else
					rm -f "$i"
				    fi
				else
				    echo "Ignoring already removed file \"$i\"." >&2
				fi
			    done
			done
		  rm -f $dico_varlib_remove )
	    fi
	fi
    ;;

    abort-upgrade)
    ;;

    *)
	echo "preinst called with unknown argument \`$1'" >&2
	exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.



exit 0

# vim:sw=4:
