#!/bin/sh

set -e

getent group dpmmgr > /dev/null || \
    addgroup --quiet --system dpmmgr

getent passwd dpmmgr > /dev/null || \
    adduser --quiet --system --home /var/lib/dpm --shell /bin/sh \
    --ingroup dpmmgr --disabled-password --disabled-login \
    --gecos "DPM manager" dpmmgr

chown dpmmgr:dpmmgr /var/log/dpmcopy

update-alternatives --install /usr/sbin/dpmcopyd dpmcopyd \
          /usr/lib/dpm-postgres/dpmcopyd 10 \
  --slave /usr/share/man/man8/dpmcopyd.8.gz dpmcopyd.8.gz \
          /usr/lib/dpm-postgres/dpmcopyd.8.gz \
  --slave /etc/init.d/dpmcopyd dpmcopyd.init \
          /etc/dpm-postgres/dpmcopyd.init \
  --slave /etc/default/dpmcopyd dpmcopyd.conf \
          /etc/dpm-postgres/dpmcopyd.conf \
  --slave /etc/logrotate.d/dpmcopyd dpmcopyd.logrotate \
          /etc/dpm-postgres/dpmcopyd.logrotate

if [ -x "/etc/init.d/dpmcopyd" ]; then
	update-rc.d dpmcopyd defaults >/dev/null
	if [ -x "`which invoke-rc.d 2>/dev/null`" ]; then
		invoke-rc.d dpmcopyd start || exit $?
	else
		/etc/init.d/dpmcopyd start || exit $?
	fi
fi


