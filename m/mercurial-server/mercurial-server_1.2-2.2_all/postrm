#!/bin/sh
# postrm script for mercurial-server

set -e

# Load debconf
. /usr/share/debconf/confmodule

# Check if the user wants the repositories removed on purging
remove_repositories_on_purge() {
  db_get mercurial-server/purge_repositories || RET=false
  if [ "$RET" = "true" ]; then
    return 0
  else
    return 1
  fi
}

case "$1" in
    purge)
        if remove_repositories_on_purge; then
            echo -n "Removing hg user and purging data..."
            deluser --remove-home --quiet --system hg > /dev/null || true
            delgroup --quiet --system hg > /dev/null || true
            echo done
        fi
    ;;

    remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
    ;;

    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

# Automatically added by dh_installdebconf
if [ "$1" = purge ] && [ -e /usr/share/debconf/confmodule ]; then
	. /usr/share/debconf/confmodule
	db_purge
fi
# End automatically added section


exit 0
