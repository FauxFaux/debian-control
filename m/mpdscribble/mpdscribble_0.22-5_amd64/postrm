#! /bin/sh
set -e

if [ "$1" = "purge" ] ; then
    # remove log files
    rm -f /var/log/mpdscribble.log*

    # remove cache
    rm -f /var/cache/mpdscribble/*

    # remove overrides
    if dpkg-statoverride --list --quiet /var/cache/mpdscribble/cache >/dev/null; then
        dpkg-statoverride --force --quiet --remove /var/cache/mpdscribble/cache
    fi
    if dpkg-statoverride --list --quiet /var/cache/mpdscribble >/dev/null; then
        dpkg-statoverride --force --quiet --remove /var/cache/mpdscribble
    fi
    if dpkg-statoverride --list --quiet /etc/mpdscribble.conf >/dev/null; then
        dpkg-statoverride --force --quiet --remove /etc/mpdscribble.conf
    fi
    
    # delete user
    if getent passwd mpdscribble >/dev/null; then
        if [ -x /usr/sbin/deluser ]; then
            deluser --system mpdscribble
        fi
    fi
    # delete group
    if getent group mpdscribble >/dev/null; then
        if [ -x /usr/sbin/delgroup ]; then
            delgroup mpdscribble
        fi
    fi

    # delete ucf handled config file
    for ext in '~' '%' .bak .ucf-new .ucf-old .ucf-dist;  do
        rm -f /etc/mpdscribble.conf$ext
        rm -f /etc/default/mpdscribble$ext
    done
 
    # remove the configuration file itself
    rm -f /etc/mpdscribble.conf
    rm -f /etc/default/mpdscribble

    # and finally clear it out from the ucf database
    if which ucf >/dev/null; then
        ucf --debconf-ok --purge /etc/mpdscribble.conf
        ucf --debconf-ok --purge /etc/default/mpdscribble
    fi    
    if which ucfr >/dev/null; then
        ucfr --purge mpdscribble /etc/mpdscribble.conf
        ucfr --purge mpdscribble /etc/default/mpdscribble
    fi    
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

# Automatically added by dh_installinit
if [ "$1" = "purge" ] ; then
	update-rc.d mpdscribble remove >/dev/null
fi


# In case this system is running systemd, we make systemd reload the unit files
# to pick up changes.
if [ -d /run/systemd/system ] ; then
	systemctl --system daemon-reload >/dev/null || true
fi
# End automatically added section
# Automatically added by dh_systemd_enable
if [ "$1" = "remove" ]; then
	if [ -x "/usr/bin/deb-systemd-helper" ]; then
		deb-systemd-helper mask mpdscribble.service >/dev/null
	fi
fi

if [ "$1" = "purge" ]; then
	if [ -x "/usr/bin/deb-systemd-helper" ]; then
		deb-systemd-helper purge mpdscribble.service >/dev/null
		deb-systemd-helper unmask mpdscribble.service >/dev/null
	fi
fi
# End automatically added section
# Automatically added by dh_installdebconf
if [ "$1" = purge ] && [ -e /usr/share/debconf/confmodule ]; then
	. /usr/share/debconf/confmodule
	db_purge
fi
# End automatically added section


exit 0
