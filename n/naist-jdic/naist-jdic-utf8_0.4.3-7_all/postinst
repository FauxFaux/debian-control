#!/bin/sh
# postinst script for naist-jdic-utf8
#
# see: dh_installdeb(1)

set -e

priority="80"

chasendir=/usr/share/chasen
chasenrc=${chasendir}/chasenrc
dictdir=${chasendir}/dic/naist-jdic
files="cforms.cha connect.cha ctypes.cha grammar.cha naist-jdic.dic"

srcdir=${dictdir}-utf8
destdir=/var/lib/chasen/dic/naist-jdic-utf8
GENDATA="matrix.cha table.cha chadic.da chadic.lex chadic.dat"

case "$1" in
    configure)

    [ -d ${srcdir} ]  || mkdir ${srcdir} 
    [ -d ${destdir} ] || mkdir ${destdir}

    echo "Now generating naist-jdic data. This may take a while..."

# convert euc-jp to UTF-8
    [ -d ${dictdir} ] || exit 1
    for data in $files
     do iconv -f eucjp -t utf8 -o ${dictdir}-utf8/${data} ${dictdir}/${data} 
    done

    iconv -f eucjp -t utf8 -o ${chasenrc}-utf8 ${chasenrc}
   
#   for matrix.cha table.cha
    [ -d "${srcdir}" ] && [ -d "${destdir}" ] || exit 1
    cd ${srcdir} && `chasen-config --mkchadic`/makemat -i w

#   for chadic.da chadic.lex chadic.dat
    [ -d "${srcdir}" ] && [ -d "${destdir}" ] || exit 1
    cd ${srcdir} && `chasen-config --mkchadic`/makeda -i w chadic *.dic 
    
    for i in `ls ${srcdir}/*`; do ln -s $i ${destdir}; done

    echo ""
    echo ""
    echo "Done! Check ${destdir} directory."

# specify encoding
    if [ -z `grep '(ENCODE "u")' ${chasenrc}-utf8` ] && 
       [ -z `grep '(ENCODE "w")' ${chasenrc}-utf8` ]; then
      echo '(ENCODE "u")' >> ${chasenrc}-utf8
    fi

    update-alternatives \
     --install /etc/chasenrc chasenrc ${chasenrc}-utf8 ${priority} \
     --slave /var/lib/chasen/dic/debian chasen-dictionary ${destdir} 


    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.



exit 0
