#!/bin/sh
# preinst script for magic
#
# see: dh_installdeb(1)

set -e

# summary of how this script can be called:
#        * <new-preinst> `install'
#        * <new-preinst> `install' <old-version>
#        * <new-preinst> `upgrade' <old-version>
#        * <old-preinst> `abort-upgrade' <new-version>
# for details, see https://www.debian.org/doc/debian-policy/ or
# the debian-policy package


case "$1" in
    install|upgrade)
        if [ -d /usr/share/openstreetmap-carto/data ] && [ ! -L /usr/share/openstreetmap-carto/data ] ; then
            mv /usr/share/openstreetmap-carto/data /usr/share/openstreetmap-carto/data.old
        fi

        # Clean up if previous upgrade has left strange files:
        if [ -L /usr/share/openstreetmap-carto/data.old/data ] ; then
            rm -f /usr/share/openstreetmap-carto/data.old/data
        fi
        if [ -L /usr/share/openstreetmap-carto/data.old ] ; then
            rm -f /usr/share/openstreetmap-carto/data.old
        fi
        if [ -L /usr/share/openstreetmap-carto/symbols/symbols ] ; then
            rm -f /usr/share/openstreetmap-carto/symbols/symbols
        fi

        # If data directory exists in openstreetmap-carto-common, it
        # is safe to delete data.old in openstreetmap-carto:
        if [ -d /usr/share/openstreetmap-carto/data.old ] && \
           [ ! -L /usr/share/openstreetmap-carto/data.old ] && \
           [ -d /usr/share/openstreetmap-carto-common/data ] && \
           [ ! -L /usr/share/openstreetmap-carto-common/data ]
        then
            rm -rf /usr/share/openstreetmap-carto/data.old
        fi

    ;;

    abort-upgrade)
    ;;

    *)
        echo "preinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# This is necessary in order to replace the dir with a symbolic link since a dir will never be
# replaced by a symbolic link during upgrade if not done in maintainer scripts.
dpkg-maintscript-helper dir_to_symlink /usr/share/openstreetmap-carto/symbols \
     ../openstreetmap-carto-common/symbols 2.35.0-2 openstreetmap-carto -- "$@"

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.



exit 0
