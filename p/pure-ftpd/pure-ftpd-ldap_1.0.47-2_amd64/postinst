#! /bin/sh
# postinst script for all pure-ftpd flavours

set -e

# get settings from debconf
. /usr/share/debconf/confmodule
db_get pure-ftpd/standalone-or-inetd
SOI="$RET"

FLAVOUR=

case "$0" in
	*mysql*)
		chmod 600 /etc/pure-ftpd/db/mysql.conf
		FLAVOUR="mysql"
		;;
	*postgresql*)
		chmod 600 /etc/pure-ftpd/db/postgresql.conf
		FLAVOUR="postgresql"
		;;
	*ldap*)
		chmod 600 /etc/pure-ftpd/db/ldap.conf
		FLAVOUR="ldap"
		;;
esac

if [ "$SOI" = "inetd" ]; then
	test -x "/etc/init.d/pure-ftpd" && /etc/init.d/pure-ftpd stop

	FTPENTRY="ftp stream tcp nowait root /usr/sbin/tcpd /usr/sbin/pure-ftpd-wrapper $FLAVOUR"
	update-inetd --group STANDARD --add "$FTPENTRY"
else
	update-inetd --disable ftp
fi

# Automatically added by dh_installinit/11.5.3
if [ "$1" = "configure" ] || [ "$1" = "abort-upgrade" ] || [ "$1" = "abort-deconfigure" ] || [ "$1" = "abort-remove" ] ; then
	if [ -x "/etc/init.d/pure-ftpd-ldap" ]; then
		update-rc.d pure-ftpd-ldap defaults >/dev/null
		invoke-rc.d pure-ftpd-ldap start || exit 1
	fi
fi
# End automatically added section


# Don't wait on pure-ftpd to close file handles
db_stop
