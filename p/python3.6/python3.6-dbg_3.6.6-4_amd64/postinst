#! /bin/sh

set -e

if [ "$1" = configure ]; then
    files=$(dpkg -L libpython3.6-dbg:amd64 | sed -n '/^\/usr\/lib\/python3.6\/.*\.py$/p')
    if [ -n "$files" ]; then
	/usr/bin/python3.6 -E -S /usr/lib/python3.6/py_compile.py $files
	if grep -sq '^byte-compile[^#]*optimize' /etc/python/debian_config; then
	    /usr/bin/python3.6 -E -S -O /usr/lib/python3.6/py_compile.py $files
	fi
    else
	echo >&2 "python3.6-dbg: can't get files for byte-compilation"
    fi

  if [ -d /usr/include/python3.6_d ] && [ ! -h /usr/include/python3.6_d ]; then
    if rmdir /usr/include/python3.6_d 2> /dev/null; then
      ln -sf python3.6dmu /usr/include/python3.6_d
    else
      echo >&2 "WARNING: non-empty directory on upgrade: /usr/include/python3.6_d"
      ls -l /usr/include/python3.6_d
    fi
  fi
  if [ -d /usr/lib/python3.6/config_d ] && [ ! -h /usr/lib/python3.6/config_d ]; then
    if rmdir /usr/lib/python3.6/config_d 2> /dev/null; then
      ln -sf config-dmu /usr/lib/python3.6/config_d
    else
      echo >&2 "WARNING: non-empty directory on upgrade: /usr/lib/python3.6/config_d"
      ls -l /usr/lib/python3.6/config_d
    fi
  fi
fi



exit 0
