#!/bin/sh

set -e

. /usr/share/debconf/confmodule
if [ -f /usr/share/dbconfig-common/dpkg/postrm ]; then
  . /usr/share/dbconfig-common/dpkg/postrm

  # remove both current and old instances
  instances=$(ls -1 /etc/redmine/*/database.yml | xargs dirname | xargs -n 1 basename)
  for inst in $instances; do
    dbc_go redmine/instances/$inst "$@"

    if [ "$1" = "purge" ]; then
      config="/etc/redmine/$inst/database.yml"
      rm -f "$config"
      if which ucf >/dev/null 2>&1; then
	ucf --purge "$config"
	ucfr --purge redmine "$config"
      fi
    fi
  done
fi

if [ "$1" = purge ]; then
  rm -rf /var/log/redmine
  rm -rf /var/cache/redmine
  rm -rf /var/lib/redmine
  rm -rf /etc/redmine
fi

## Automatically added by dh_installdebconf
if [ "$1" = purge ] && [ -e /usr/share/debconf/confmodule ]; then
	. /usr/share/debconf/confmodule
	db_purge
fi
# End automatically added section
#
