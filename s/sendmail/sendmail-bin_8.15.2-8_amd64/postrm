#!/bin/sh
set -e;

PACKAGE=sendmail-bin;

if [ "$1" = "purge" ]; then

	if dpkg-statoverride --list /usr/lib/sm.bin/sendmail >/dev/null ; then
		dpkg-statoverride --remove /usr/lib/sm.bin/sendmail
	fi
	if dpkg-statoverride --list /usr/lib/sm.bin/mailstats >/dev/null ; then
		dpkg-statoverride --remove /usr/lib/sm.bin/mailstats
	fi

		# If postrm is called *AND* there are no files, exit quickly
		# (This is a *GROSS* hack... beter use the test below)
		#if [ ! -s `echo "$0" | sed -e 's/postrm$/list/'` ]; then
		#		echo "Purging replaced package $PACKAGE, nothing to do...";
		#		exit 0;
		#		fi;

		# We're *really* purging; neither sendmail nor sendmail-tls
		# is currently installed
		if [ -f /usr/lib/sm.bin/sendmail ]; then
			echo "Purging replaced package $PACKAGE, nothing to do...";
			exit 0;
			fi;

		# Currently, dh_installdebconf doesn't do db_stop... ensure it is done!
		if [ -e /usr/share/debconf/confmodule ]; then
			# Source debconf library.
			. /usr/share/debconf/confmodule;
			# Make sure we're done
			#db_stop;
			# Remove my changes to the db.
			db_purge;
			fi;

		rm -f /etc/mail/sendmail.cf.old
		rm -f /etc/mail/submit.cf.old
fi

# Automatically added by dh_installinit
if [ "$1" = "purge" ] ; then
	update-rc.d sendmail remove >/dev/null
fi


# In case this system is running systemd, we make systemd reload the unit files
# to pick up changes.
if [ -d /run/systemd/system ] ; then
	systemctl --system daemon-reload >/dev/null || true
fi
# End automatically added section

