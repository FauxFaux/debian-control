#! /bin/sh

set -e

. /usr/share/debconf/confmodule

db_version 2.0
db_capb 'backup'
CAPB=$RET

if [ -f /etc/uprecords-cgi/uprecords.conf ]; then
	LAYOUT=`grep '^LAYOUT=' /etc/uprecords-cgi/uprecords.conf |
	    head -1 |
	    sed -e 's/^LAYOUT=//'`
	MAXENTRIES=`grep '^SHOW_MAX=' /etc/uprecords-cgi/uprecords.conf |
	    head -1 |
	    sed -e 's/^SHOW_MAX=//'`
	if [ -n "$LAYOUT" ]; then db_set 'uprecords-cgi/layout' $LAYOUT; fi
	if [ -n "$MAXENTRIES" ]; then
		db_set 'uprecords-cgi/maxentries' $MAXENTRIES
	fi
fi

STATE=1
while [ "$STATE" != 0 -a "$STATE" != 3 ]; do
	case "$STATE" in
	1)
		db_input medium 'uprecords-cgi/layout' || true
	;;
	2)
		db_input medium 'uprecords-cgi/maxentries' || true
	;;
	esac

	if db_go; then
		STATE=$(($STATE + 1))
	else
		STATE=$(($STATE - 1))
	fi
done

hostname=`hostname --fqdn`

if [ -z "$hostname" ]; then
	hostname='localhost'
fi

db_subst 'uprecords-cgi/install_note' hostname $hostname
db_input low 'uprecords-cgi/install_note' || true
db_go || true

db_stop
