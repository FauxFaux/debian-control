#!/bin/sh -e
set -e

# oops.  Needed to check version on upgrade.  Now just need to remove old ones.
for i in 1 2 3 4 5 6 ; do
    update-alternatives --remove xemacs21 /usr/bin/xemacs-21.4.$i-mule
done

update-alternatives --install /usr/bin/xemacs21 xemacs21 /usr/bin/xemacs21-mule 70

# Ok we dont' want to compile these files when we already have another
# installed.
ALREADY_MULE=0
ALREADY_NOMULE=0
for i in mule mule-canna-wnn gnome-mule gnome-mule-canna-wnn ; do
  STAT=`dpkg -s xemacs21-$i 2> /dev/null | perl -ne 'next if $_ !~ m/^Status/; $_ =~ s/^Status:\s*(.*)/$1/; print;'`
  if [ "mule" != "$i" -a "$STAT" = "install ok installed" ] ; then
    ALREADY_MULE=1
  fi
done

for i in nomule gnome-nomule ; do
  STAT=`dpkg -s xemacs21-$i 2> /dev/null | perl -ne 'next if $_ !~ m/^Status/; $_ =~ s/^Status:\s*(.*)/$1/; print;'`
  if [ "mule" != "$i" -a "$STAT" = "install ok installed" ] ; then
    ALREADY_NOMULE=1
  fi
done

#if [ "$ALREADY_MULE" = "0" ] ; then
   #/usr/lib/emacsen-common/emacs-install xemacs21-mule
#fi

#if [ "$ALREADY_NOMULE" = "0" ] ; then
   #/usr/lib/emacsen-common/emacs-install xemacs21-nomule
#fi

if [ "$ALREADY_NOMULE" = "0" -a "$ALREADY_MULE" = "0" ] ; then
   /usr/lib/emacsen-common/emacs-install xemacs21
fi

## Automatically added by dh_installmenu/11.3.5
if [ "$1" = "configure" ] && [ -x "`which update-menus 2>/dev/null`" ]; then
	update-menus
fi
# End automatically added section
#
