#!/bin/sh

set -e

zope=zope2.13

delete_pyo_pyc () {
	t=`tempfile -p zopedel `
	[ -r /var/lib/$zope/_list_of_pyc_pyo_to_be_deleted_ ] && 
	cat /var/lib/$zope/_list_of_pyc_pyo_to_be_deleted_ | \
	    xargs rm -f 2>&1
	rm -f /usr/lib/$zope/debian/*.py[co] 
	rm -f /var/lib/$zope/_list_of_pyc_pyo_to_be_deleted_
}

case "$1" in
    failed-upgrade|abort-install|abort-upgrade|disappear)
    ;;
    upgrade)
	delete_pyo_pyc
    ;;
    remove)
	delete_pyo_pyc
    ;;
    purge)
	if [ -d /var/lib/$zope/instance ] ; then
	 find /var/lib/$zope/instance  -maxdepth 3 -type f \
            -path '*/var/Data.fs.*' -or -path '*/bin/*zope*' \
            -or -path '*/log/*.log*' -or  -name README.txt \
                 | xargs -r rm -f
	fi
    ;;

    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 1

esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

# Automatically added by dh_installinit
if [ "$1" = "purge" ] ; then
	update-rc.d zope2.13 remove >/dev/null
fi


# In case this system is running systemd, we make systemd reload the unit files
# to pick up changes.
if [ -d /run/systemd/system ] ; then
	systemctl --system daemon-reload >/dev/null || true
fi
# End automatically added section


exit 0
